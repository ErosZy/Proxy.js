(function(a,b){var c=typeof define=="function",d=typeof module!="undefined"&&module.exports;if(c){define("./"+a,b)}else{if(d){module.exports=b()}else{this[a]=b()}}}("Proxy",function(){var d=Array.prototype.splice,b=Array.prototype.indexOf,a=typeof process!="undefined"?process.nextTick:setTimeout;function c(){if(!(this instanceof c)){return new c()}this._binds={};this._callbacks=[]}c.prototype._assign=function(l,o){var q=this,n=0,m=0,g={},f=/\s+/g,h=o.toString();l=q._makeArray(l);n=l.length;h=h.replace(f,"");for(var k=0;k<n;k++){var p=l[k];q._binds[p]=q._binds[p]?q._binds[p]:[];q._binds[p].push({callback:o,fnStr:h,bind:j})}q._callbacks.push({fnStr:h,binds:l,callback:e});function j(i,r){m++;if(r){g[i]=r}}function e(r,x,s){var w=[],v;if(m<n){return false}v=q._callbacks[s];if(q._inArray(r,v.binds)==-1){return false}for(var u=0;u<n;u++){var t=l[u];w.push(g[t])}o.apply(q,w)}};c.prototype.addListener=function(f,g){var e=this;e._assign.apply(e,arguments);return e};c.prototype.removeListener=function(l,o){var q=this,m=arguments.length,f,h,n,p,e;if(!m){q._binds={};q._callbacks=[]}else{if(m<2){h=q._binds[l];for(var k=0,m=h.length;k<m;k++){n=h[k].callback;q.removeListener(l,n)}}else{f=o.toString().replace(/\s+/g,"");h=q._binds[l];e=q._callbacks;loop:for(var k=h.length-1;k>=0;k--){p=h[k];if(p.fnStr==f){d.call(h,[k,1]);for(var g=e.length-1;g>=0;g--){if(e[g].fnStr==f&&q._inArray(l,e[g].binds)!=-1){d.apply(e,[g,1]);continue loop}}}}}}return q};c.prototype.removeAllListeners=function(g){var f=this,e=arguments.length;if(!e){f.removeListener()}else{f.removeListener(g)}return f};c.prototype.once=function(e,h){var f=this,g;e=f._makeArray(e);g=function(){h.apply(f,arguments);for(var k=0,j=e.length;k<j;k++){f.removeListener(e[k],g)}};f._assign(e,g);return f};c.prototype.emit=function(f,k){var e=this,h=2,l=e._binds[f]||[],j=e._callbacks;while(h--){if(h){for(var g=l.length-1;g>=0;g--){l[g].bind.apply(e,[f,k])}}else{for(var g=j.length-1;g>=0;g--){j[g].callback.apply(e,[f,k,g])}}}return e};c.prototype.emitLater=function(f,g){var e=this;a(function(){e.emit(f,g)},0);return e};c.prototype.all=function(f,h){var g=this,e=arguments.length;if(e<2){return}g.once(f,h);return g};c.prototype.immediate=function(f){var g=this,e=arguments.length,j,l,k;if(e<3){k=[];l=arguments[1]}else{k=g._makeArray(arguments[1]);l=arguments[2]}f=g._makeArray(f);g.once(f,l);for(var h=0,e=f.length;h<e;h++){j=f[h];g.emit(f[h],k[h])}return g};c.prototype.fail=function(f){var e=this;e.once("error",function(g){e.removeAllListeners();f.call(e,g)});return e};c.prototype.tail=function(e,g){var f=this;e=f._makeArray(e);f.once(e,function(){g.apply(f,arguments);for(var j=0,h=e.length;j<h;j++){(function(i){a(function(){f.once(i,g)},0)}(e[j]))}});return f};c.prototype.after=function(l,f,o){var p=this,n=arguments.length,m=0,g=[],h=/\s+/g,k=p._binds,i;if(n<3||!p._is(o,"Function")){return p}i=o.toString().replace(h,"");k[l]=k[l]?k[l]:[];k[l].push({callback:o,fnStr:i,bind:j});p._callbacks.push({fnStr:i,binds:[l],callback:e});function j(q,r){m++;if(r){g.push(r)}}function e(q,t,r){var s;if(m<f){return false}s=p._callbacks[r];if(p._inArray(q,s.binds)==-1){return false}o.call(p,g);p.removeListener(q,o)}return p};c.prototype.any=function(f,k){var g=this,e=arguments.length,h=/\s+/g,j;if(e<2){return false}f=g._makeArray(f);j=k.toString().replace(h,"");g._callbacks.push({fnStr:j,binds:f,callback:i});function i(l,o,m){var n=g._callbacks[m];if(g._inArray(l,n.binds)==-1){return false}k.call(g,o);d.apply(g._callbacks,[m,1])}return g};c.prototype.not=function(f,k){var g=this,e=arguments.length,h=/\s+/g,j;if(e<2){return false}f=g._makeArray(f);j=k.toString().replace(h,"");g._callbacks.push({fnStr:j,binds:f,callback:i});function i(l,o,m){var n=g._callbacks[m];if(g._inArray(l,n.binds)!=-1){return false}k.call(g,o);d.apply(g._callbacks,[m,1])}return g};c.prototype._inArray=function(k,f){var g=this,h=-1;if([].indexOf){return b.call(f,k)}else{for(var j=0,e=f.length;j<e;j++){if(f[j]==k){h=j;break}}}return h};c.prototype._makeArray=function(e){var f=this;if(!f._is(e,"Array")){e=[e]}else{e=[].concat.apply([],e)}return e};c.prototype._is=function(f,e){return Object.prototype.toString.call(f)=="[object "+e+"]"};return c}));